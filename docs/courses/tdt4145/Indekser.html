<!DOCTYPE html>
<html>
  <head>
    <!-- Katex -->
    <link rel="stylesheet" href=
        "https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"/>

    <!-- GitHub Markdown Styles -->
    <link rel="stylesheet" href=
        "https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css"/>

    <title>Indekser.md</title>
    <link rel="icon" type="image/x-icon" href="../../favicon.png"/>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../styles.css">
  
  </head>

  <body class="markdown-body">
    <div class="page flex-row">
      <div class="col">
        
<p><h4><a href="../index.html">courses/</a><a href="./index.html">tdt4145</a>
</h4></p>
<ul>
<li>ğŸ“‚ <a href="./assets/index.html">assets</a></li>
<li>ğŸ“„ <a href="Boka.html">Boka</a></li>
<li>ğŸ“„ <a href="Datamodellering.html">Datamodellering</a></li>
<li>ğŸ“„ <a href="Del 2.html">Del 2</a></li>
<li>ğŸ“„ <a href="Indekser.html">Indekser âœ¨</a></li>
<li>ğŸ“„ <a href="Lagring.html">Lagring</a></li>
<li>ğŸ“„ <a href="Normalisering.html">Normalisering</a></li>
<li>ğŸ“„ <a href="Queryutf%C3%B8ring.html">QueryutfÃ¸ring</a></li>
<li>ğŸ“„ <a href="Relasjonsalgebra.html">Relasjonsalgebra</a></li>
<li>ğŸ“„ <a href="Relasjonsdatabaser.html">Relasjonsdatabaser</a></li>
<li>ğŸ“„ <a href="SQL.html">SQL</a></li>
<li>ğŸ“„ <a href="Transaksjoner.html">Transaksjoner</a></li>
</ul>
<p><h4>Table of Contents</h4></p>
<nav class="table-of-contents"><ol><li><a href="#indekser">Indekser</a><ol><li><a href="#indekser-1">Indekser</a><ol><li><a href="#hvorfor-bruke-indekser%3F">Hvorfor bruke indekser?</a></li><li><a href="#begreper-innen-indeksering">Begreper innen indeksering</a></li><li><a href="#lagrings--og-indekseringsmuligheter-(1)">Lagrings- og indekseringsmuligheter (1)</a></li><li><a href="#lagrings--og-indekseringsmuligheter-(2)">Lagrings- og indekseringsmuligheter (2)</a></li><li><a href="#lagrings--og-indekseringsmuligheter-(3)">Lagrings- og indekseringsmuligheter (3)</a></li><li><a href="#b%2B-tr%C3%A6r">B+-trÃ¦r</a></li><li><a href="#b%2B-tre%2C-eksempel">B+-tre, eksempel</a></li><li><a href="#b%2B-tr%C3%A6r-i-praksis">B+-trÃ¦r i praksis</a></li><li><a href="#poster-i-b%2B-tr%C3%A6r">Poster i B+-trÃ¦r</a></li><li><a href="#quiz-1">Quiz 1</a></li><li><a href="#quiz-2">Quiz 2</a></li><li><a href="#blokksplitting-i-b%2B-tre">Blokksplitting i B+-tre</a></li><li><a href="#indekser-p%C3%A5-sammensatte-n%C3%B8kler">Indekser pÃ¥ sammensatte nÃ¸kler</a></li></ol></li></ol></li></ol></nav>
      </div>
      <article class="col content">
        
<h1 id="indekser" tabindex="-1">Indekser</h1>
<h2 id="indekser-1" tabindex="-1">Indekser</h2>
<h3 id="hvorfor-bruke-indekser%3F" tabindex="-1">Hvorfor bruke indekser?</h3>
<ul>
<li>For Ã¥ gjÃ¸re queries raskere
<ul>
<li>Student (pnr, studnr, navn, adresse, epost)
<ul>
<li>SELECT navn, adresse FROM Student WHERE studnr=123456;</li>
</ul>
</li>
<li>Film (id, fnavn, Ã¥r, selskap, nasjonalitet, score)
<ul>
<li>SELECT fnavn, Ã¥r FROM Film WHERE score &gt; 7.0;</li>
</ul>
</li>
</ul>
</li>
<li>For Ã¥ tvinge gjennom UNIQUE og PRIMARY KEY-restriksjoner
<ul>
<li>Ha indeks pÃ¥ det som er unikt</li>
<li>Student (pnr, studnr, navn, adresse, epost)</li>
</ul>
</li>
</ul>
<h3 id="begreper-innen-indeksering" tabindex="-1">Begreper innen indeksering</h3>
<ul>
<li><strong>Indeksfelt</strong>: Felt / attributt av posten som indeksen bruker</li>
<li><strong>PrimÃ¦rindeks</strong>: Indeks pÃ¥ primÃ¦rnÃ¸kkelen</li>
<li><strong>Clustered indeks</strong>: Indeks pÃ¥ en tabell hvor postene er fysisk lagret sammen med (i) indeksen
<ul>
<li>I MySQL fÃ¥r du clustered indeks automatisk</li>
</ul>
</li>
<li><strong>SekundÃ¦rindeks</strong>: Ekstra indeks pÃ¥ et annet felt hvor det ogsÃ¥ finnes en primÃ¦rindeks.
<ul>
<li>SekundÃ¦rindeksen kan vÃ¦re brukt for Ã¥ tvinge gjennom UNIQUE, dvs. en unik verdi for hver post i tabellen
<ul>
<li>Student (pnr, studnr, navn, adresse, epost)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="lagrings--og-indekseringsmuligheter-(1)" tabindex="-1">Lagrings- og indekseringsmuligheter (1)</h3>
<ul>
<li>Systemspesifikt, se dokumentasjon av Â«dittÂ» system</li>
<li>Clustered B+-tree / clustered index
<ul>
<li>B+-tre pÃ¥ primÃ¦rnÃ¸kkel</li>
<li>LÃ¸vnivÃ¥ av treet lagrer selve posten</li>
<li>MySQL: InnoDB</li>
<li>SQL Server: Clustered index nÃ¥r primÃ¦rnÃ¸kkel er definert</li>
</ul>
</li>
<li>Heapfil og B+-tre
<ul>
<li>Tabell lagret i heapfil</li>
<li>B+-tre pÃ¥ primÃ¦rnÃ¸kkel. Postene blir da (key, RecordID)</li>
<li>Evt. annen indeks pÃ¥ et annet felt</li>
<li>MySQL: MyISAM
<ul>
<li>Legacy</li>
</ul>
</li>
<li>SQL Server: Heap + unclustered index</li>
</ul>
</li>
</ul>
<h3 id="lagrings--og-indekseringsmuligheter-(2)" tabindex="-1">Lagrings- og indekseringsmuligheter (2)</h3>
<ul>
<li>Heapfil
<ul>
<li>Postene lagres forlÃ¸pende uten noen annen organisering</li>
<li>SQL Server: Hvis primÃ¦rnÃ¸kkel ikke er definert</li>
</ul>
</li>
<li>Clustered hash index
<ul>
<li>Hashindeks pÃ¥ primÃ¦rnÃ¸kkel</li>
<li>Posten lagret i indeksen</li>
<li>Oracle: Hash cluster</li>
</ul>
</li>
<li>LSM-trees (log-structured merge trees)
<ul>
<li>Google: Big Table</li>
<li>Moderne lagrings- og indekseringsmetode for Big Data
<ul>
<li>..som er stadig voksende.</li>
</ul>
</li>
<li>Â«CacherÂ» de nyeste innsatte/oppdaterte postene.</li>
<li>HÃ¸y skriveytelse, lav Â«write amplificationÂ», bedre komprimering</li>
<li>Eldre poster flyttes over i Â«langtidslagerÂ» (flere nivÃ¥er)</li>
<li>Sqlite3, NoSQL, RocksDB, MySQL/myRocks, Apache Hbase</li>
</ul>
</li>
</ul>
<h3 id="lagrings--og-indekseringsmuligheter-(3)" tabindex="-1">Lagrings- og indekseringsmuligheter (3)</h3>
<ul>
<li>Column stores
<ul>
<li>Tradisjonelt lagres tabellens rader i SQL-databaser</li>
<li>Analyseapplikasjoner / datavarehus vil oppleve bedre ytelse med kolonnebasert lagring</li>
<li>Leser mindre data ved queries og kan bruke komprimering</li>
<li>Kan komprimere pÃ¥ flere mÃ¥ter</li>
<li>SELECT MAX(score) FROM Film;</li>
<li>SQL Server: Columnstore index + delta store for Ã¥ samle nok oppdateringer til Ã¥ flette sammen med kolonnen.</li>
<li>Apache Kudu (Hadoop platform), C-store/VoltDB</li>
</ul>
</li>
<li>AI-genererte indekser (f.eks. Recursive Model Indexes)
<ul>
<li>Indekser laget basert pÃ¥ maskinlÃ¦ring</li>
<li>SvÃ¦rt effektive pÃ¥ read-only data, men sliter med oppdateringer
<ul>
<li>Genererer indekser pÃ¥ eksisterende data, kan vÃ¦re problematisk ved innsetting</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="b%2B-tr%C3%A6r" tabindex="-1">B+-trÃ¦r</h3>
<ul>
<li>Den mest brukte indeksen</li>
<li>HÃ¸ydebalansert tre med blokker som noder</li>
<li>Alle Â«brukerposterÂ» er pÃ¥ lÃ¸vnivÃ¥ (Â«nederstÂ»)</li>
<li>Typisk hÃ¸yde: 2, 3 eller 4.
<ul>
<li><em>Ikke som i algdat! HÃ¸yden er antall nivÃ¥er.</em></li>
</ul>
</li>
<li>Minimum 50 % fyllgrad i blokker</li>
<li>Gjennomsnittlig 67 % fyllgrad i blokker</li>
<li>Postene er sortert pÃ¥ nÃ¸kkelen, og treet stÃ¸tter da
<ul>
<li>LikhetssÃ¸k (direktesÃ¸k)</li>
<li>VerdiomrÃ¥desÃ¸k</li>
<li>Sekvensielle, sorterte skan</li>
<li>Gode pÃ¥ det meste, ogsÃ¥ for dynamiske datamengder</li>
</ul>
</li>
<li>Ikke sÃ¥ gode pÃ¥ innsetting av store mengder</li>
</ul>
<h3 id="b%2B-tre%2C-eksempel" tabindex="-1">B+-tre, eksempel</h3>
<p><img src="assets/Pasted image 20220401085019.png" alt=""></p>
<h3 id="b%2B-tr%C3%A6r-i-praksis" tabindex="-1">B+-trÃ¦r i praksis</h3>
<ul>
<li>Typisk fanout: 133</li>
<li>Typisk fyllgrad: 67 %</li>
<li>Typisk kapasistet (non-clustered B+-tree)
<ul>
<li>HÃ¸yde 3 : 1333 = 2 352 637 poster</li>
<li>HÃ¸yde 4 : 1334 = 312 900 700 poster</li>
</ul>
</li>
<li>Clustered B+-tre
<ul>
<li>HÃ¸yde 4: 133 * 133 * 133 * 20 = 47 millioner poster</li>
</ul>
</li>
<li>I praksis er de Ã¸verste nivÃ¥ene alltid i buffer (RAM)
<ul>
<li>Level 3 1 blokk 8 KB</li>
<li>Level 2 133 blokker 1 MB</li>
<li>Level 1 17 689 blokker 133 MB</li>
<li>Level 0 2,3 mill blokker 18 GB</li>
</ul>
</li>
</ul>
<h3 id="poster-i-b%2B-tr%C3%A6r" tabindex="-1">Poster i B+-trÃ¦r</h3>
<ul>
<li>Tabell: Student (pnr, studnr, navn, adresse, epost)</li>
<li>Clustered B+-tree</li>
<li>LÃ¸vnivÃ¥ (level=0):
<ul>
<li>Hver post pÃ¥ lÃ¸vnivÃ¥ vil se slik (â€˜010195 12345â€™, 123456, â€™Hans Hansenâ€™, â€™Revekroken 1â€™, â€™<a href="mailto:hans@stud.ntnu.no">hans@stud.ntnu.no</a>â€™)</li>
<li>Hver blokk pÃ¥ lÃ¸vnivÃ¥ kan inneholde ca. 150 poster (avhengig av blokkstÃ¸rrelse)</li>
</ul>
</li>
<li>Level &gt; 0 (indeksnivÃ¥):
<ul>
<li>(â€˜020194 23456â€™, BlockId)</li>
<li>Hver blokk kan inneholde ca. 600 poster (antar indekspost er Â¼ av en vanlig post)</li>
</ul>
</li>
</ul>
<h3 id="quiz-1" tabindex="-1">Quiz 1</h3>
<ul>
<li>Hvorfor brukes B+-trÃ¦r?
<ul>
<li>De finnes overalt âœ…</li>
<li>Superraske til Ã¥ sÃ¸ke pÃ¥ mobilnr</li>
<li>Gode pÃ¥ det meste âœ…</li>
<li>Passer veldig bra til moderne cachearkitektur</li>
</ul>
</li>
<li>Hvordan lagre: Det sÃ¸kes etter primÃ¦rnÃ¸kkel og hele posten trengs?
<ul>
<li>Heapfil</li>
<li>Hashfil</li>
<li>Clustered B+-tre âœ…</li>
<li>Clustered Hashfil âœ…</li>
</ul>
</li>
</ul>
<h3 id="quiz-2" tabindex="-1">Quiz 2</h3>
<ul>
<li>Et B+-tre har kun ett nivÃ¥, hvor mangel blokker i treet?</li>
<li>1 âœ…</li>
<li>10</li>
<li>100</li>
<li>1000</li>
<li>Det sÃ¸kes etter nÃ¸kkel 15. Hvor mange blokker aksesseres?</li>
</ul>
<p><img src="assets/Pasted image 20220401091756.png" alt=""></p>
<ul>
<li>0</li>
<li>1</li>
<li>2</li>
<li>3 âœ…</li>
</ul>
<h3 id="blokksplitting-i-b%2B-tre" tabindex="-1">Blokksplitting i B+-tre</h3>
<ul>
<li>Splitting vanligvis ved midterste post</li>
<li>StÃ¸rrelsesmessig midterste post ved variabel lengde poster</li>
<li>Maks poststÃ¸rrelse kan vÃ¦re Â½ blokk, men spesiallÃ¸sninger for virkelig lange poster (BLOBs)</li>
<li>Indeksposter (level &gt; 0) er smÃ¥: nÃ¸kkel + BlockId</li>
<li>LÃ¸vnodeposter kan vÃ¦re stÃ¸rre. Hvorfor?</li>
</ul>
<h3 id="indekser-p%C3%A5-sammensatte-n%C3%B8kler" tabindex="-1">Indekser pÃ¥ sammensatte nÃ¸kler</h3>
<ul>
<li>Employee (ssn, dno, age, street, zip, salary, skill)</li>
<li>SELECT * FROM Employee WHERE dno=4 and age&gt;50;</li>
<li>Hvilke indekser kan hjelpe her?
<ul>
<li>Indeks pÃ¥ dno: finn alle poster med dno=4 og sjekk om age &gt; 50</li>
<li>Indeks pÃ¥ age: scan indeksen fra 50 og finn alle poster med dno=4.</li>
<li>Sammensatt indeks pÃ¥
<ul>
<li>(age, dno)</li>
<li>(dno, age)</li>
<li>Bruk den som er mest selektiv fÃ¸rst, altsÃ¥ den som gir fÃ¦rrest poster i resultatet</li>
</ul>
</li>
<li>Indekspostene har leksikalsk sortering</li>
</ul>
</li>
</ul>

      </article>
      </div>
  </body>
</html>
