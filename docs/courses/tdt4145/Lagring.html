<!DOCTYPE html>
<html>
  <head>
    <!-- Katex -->
    <link rel="stylesheet" href=
        "https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"/>

    <!-- GitHub Markdown Styles -->
    <link rel="stylesheet" href=
        "https://cdn.jsdelivr.net/github-markdown-css/2.2.1/github-markdown.css"/>

    <title>Lagring.md</title>
    <link rel="icon" type="image/x-icon" href="../../"/>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="../../styles.css">
  
  </head>

  <body class="markdown-body">
    <div class="page flex-row">
      <div class="col">
        
<p><h4><a href="../index.html">courses/</a><a href="./index.html">tdt4145</a>
</h4></p>
<ul>
<li>ğŸ“‚ <a href="./assets/index.html">assets</a></li>
<li>ğŸ“„ <a href="Boka.html">Boka</a></li>
<li>ğŸ“„ <a href="Datamodellering.html">Datamodellering</a></li>
<li>ğŸ“„ <a href="Del 2.html">Del 2</a></li>
<li>ğŸ“„ <a href="Indekser.html">Indekser</a></li>
<li>ğŸ“„ <a href="Lagring.html">Lagring âœ¨</a></li>
<li>ğŸ“„ <a href="Normalisering.html">Normalisering</a></li>
<li>ğŸ“„ <a href="Queryutf%C3%B8ring.html">QueryutfÃ¸ring</a></li>
<li>ğŸ“„ <a href="Relasjonsalgebra.html">Relasjonsalgebra</a></li>
<li>ğŸ“„ <a href="Relasjonsdatabaser.html">Relasjonsdatabaser</a></li>
<li>ğŸ“„ <a href="SQL.html">SQL</a></li>
<li>ğŸ“„ <a href="Transaksjoner.html">Transaksjoner</a></li>
</ul>
<p><h4>Table of Contents</h4></p>
<nav class="table-of-contents"><ol><li><a href="#lagring">Lagring</a><ol><li><a href="#databasearkitektur">Databasearkitektur</a></li><li><a href="#databaselagring">Databaselagring</a></li><li><a href="#lagring-av-poster">Lagring av poster</a></li><li><a href="#postlayout">Postlayout</a></li><li><a href="#blocklayout">Blocklayout</a></li><li><a href="#buffer">Buffer</a></li><li><a href="#heapfiler">Heapfiler</a></li><li><a href="#quiz-1-a">Quiz 1 A</a></li><li><a href="#quiz-1-b">Quiz 1 B</a></li><li><a href="#hashbaserte-indekser">Hashbaserte indekser</a></li><li><a href="#statisk-hashing-(1)">Statisk hashing (1)</a></li><li><a href="#statisk-hashing-(2)">Statisk hashing (2)</a></li><li><a href="#extendible-hashing">Extendible hashing</a></li></ol></li></ol></nav>
      </div>
      <article class="col content">
        
<h1 id="lagring" tabindex="-1">Lagring</h1>
<h2 id="databasearkitektur" tabindex="-1">Databasearkitektur</h2>
<p><img src="assets/Pasted image 20220329160407.png" alt=""></p>
<p><strong>LÃ¥semodul</strong> (Locks)</p>
<ul>
<li>GjÃ¸re transaksjoner.</li>
</ul>
<p><strong>Log</strong></p>
<ul>
<li>Huske alt som foregÃ¥r</li>
<li>Rulle transaksjoner fram eller tilbake</li>
</ul>
<h2 id="databaselagring" tabindex="-1">Databaselagring</h2>
<ul>
<li>Databaser lagres i filer eller pÃ¥ Â«raw devicesÂ»
<ul>
<li>Mest vanlig med filer, Direkte I/O pÃ¥ filer</li>
<li>Â«raw devicesÂ» unngÃ¥r operativsystemets buffer</li>
<li>Noen bruker MMAP-segmenter</li>
</ul>
</li>
<li>Lagring av tabeller
<ul>
<li>Heapfil</li>
<li>B+-trÃ¦r</li>
<li>Hashfil
<ul>
<li>Raskt finne tilbake data</li>
</ul>
</li>
<li>LSM-trÃ¦r
<ul>
<li>Effektive nÃ¥r du hele tiden fÃ¥r nye data</li>
</ul>
</li>
</ul>
</li>
<li>Lagring av indeksfiler (pÃ¥ attributter)
<ul>
<li>For Ã¥ fÃ¥ rask tilgang til data i tabellene</li>
<li>Eller tvinge gjennom PRIMARY KEY / UNIQUE-restriksjoner
<ul>
<li>Hashing</li>
<li>B+-trÃ¦r</li>
<li>R-trÃ¦r (flere dimensjoner)</li>
</ul>
</li>
<li>For sortering av nÃ¸kler</li>
</ul>
</li>
<li>Kan kombinere lagring og indekser: Clustered index.</li>
</ul>
<h2 id="lagring-av-poster" tabindex="-1">Lagring av poster</h2>
<ul>
<li>En rad i en tabell er vanligvis lagret som en post (record) i en fil: tuppel vs. rad vs. post.</li>
<li>En post har felter med navn og datatype
<ul>
<li>Integer, long integer, floating point (4 og 8 byte)</li>
<li>String (fastlengde og variable lengde) (1 eller 2 byte per tegn)</li>
<li>Date/time</li>
<li>Blobs - lange felter</li>
<li>JSON (tekst)</li>
</ul>
</li>
<li>SQL-dictionary (Catalog) beskriver hvordan en tabell/post er lagret.
<ul>
<li>Lengde og datatyper</li>
<li>
<ul>
<li>mye annet</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="postlayout" tabindex="-1">Postlayout</h2>
<p><img src="assets/Pasted image 20220329162449.png" alt=""></p>
<p>Alt 1: Krever sjekk i katalog.
Alt 2: Feltvektor, vektor som peker pÃ¥ hvert attributt. Selvbeskrivende post.</p>
<h2 id="blocklayout" tabindex="-1">Blocklayout</h2>
<p><img src="assets/Pasted image 20220329162740.png" alt=""></p>
<p>Tuppel i figuren er post.
Struktur som vokser i to retninger.
PÃ¥ slutten: vektor som peker pÃ¥ postene i sortert rekkefÃ¸lge.</p>
<h2 id="buffer" tabindex="-1">Buffer</h2>
<ul>
<li>Kopi i RAM av ofte brukte blokker fra databasen</li>
<li>Databaser vil gjerne ha kontroll pÃ¥ dataene i RAM, sÃ¥ de Â«pinnesÂ» slik at Â«virtual memoryÂ» ikke kaster de ut.</li>
<li>Adaptive cache-algoritmer, med flere klasser av aksessmÃ¸nstre</li>
<li>Kan ogsÃ¥ stÃ¸tte Â«pre-fetchingÂ» av blokker.</li>
<li>Det brukes som regel en hashbasert inngang til buffer basert pÃ¥ BlockId.</li>
<li>Blokker som tilhÃ¸rer samme hashinngang lenkes sammen i RAM.</li>
<li>Blokker skrives til disk som en del av sjekkpunkting i forbindelse med logging og recovery</li>
</ul>
<h2 id="heapfiler" tabindex="-1">Heapfiler</h2>
<ul>
<li>Â«RÃ¥ttÂ» og usortert lager av poster</li>
<li>Poster settes inn pÃ¥ slutten av filen. Kan vÃ¦re to lister.</li>
</ul>
<p><img src="assets/Pasted image 20220329163652.png" alt=""></p>
<ul>
<li>Aksesseres med en RecordId (BlockId, nr. innen blokk)</li>
<li>Vanligvis har man indekser i tillegg til heapfiler</li>
<li>
<ul>
<li>lett Ã¥ sette inn posten</li>
</ul>
</li>
<li>
<ul>
<li>god til tabellscan</li>
</ul>
</li>
<li>
<ul>
<li>bra skriveytelse</li>
</ul>
</li>
<li>
<ul>
<li>dÃ¥rlig til sÃ¸k pÃ¥ attributter og rangesÃ¸k (verdiomrÃ¥desÃ¸k)</li>
</ul>
</li>
</ul>
<h2 id="quiz-1-a" tabindex="-1">Quiz 1 A</h2>
<ul>
<li>Hva er en komponent i et databasesystem?
<ul>
<li>Optimalisator âœ…</li>
<li>Filsystem âŒ</li>
<li>L3 Cache âŒ</li>
<li>Logg âœ…</li>
</ul>
</li>
<li>Hvorfor har vi indekser?
<ul>
<li>For Ã¥ fÃ¥ oversikt âŒ</li>
<li>For Ã¥ tvinge gjennom UNIQUE âœ…</li>
<li>Holde orden pÃ¥ databasen âŒ</li>
<li>For Ã¥ fÃ¥ queries til Ã¥ gÃ¥ raskere âœ…</li>
</ul>
</li>
</ul>
<h2 id="quiz-1-b" tabindex="-1">Quiz 1 B</h2>
<ul>
<li>Hva er en SQL Dictionary?
<ul>
<li>Forklaring pÃ¥ Keywords i SQL âŒ</li>
<li>Oversetter SQL til algebra âŒ</li>
<li>Oversikt over tabeller og attributter âœ…</li>
<li>Cacher queryresultater âŒ</li>
</ul>
</li>
<li>Hvorfor bruker man Heapfiler?
<ul>
<li>Raske Ã¥ sette inn poster âœ…</li>
<li>Gode til tabellscan âœ…</li>
<li>Raskt Ã¥ finne igjen en post âŒ</li>
<li>Gode til Ã¥ randomisere poster âŒ</li>
</ul>
</li>
</ul>
<h2 id="hashbaserte-indekser" tabindex="-1">Hashbaserte indekser</h2>
<ul>
<li>Bra for direkte aksess pÃ¥ sÃ¸kenÃ¸kkel</li>
<li>h(K) - hashfunksjon av sÃ¸kenÃ¸kkel
<ul>
<li>Sprer postene bra utover slik at de lett kan gjenfinnes</li>
</ul>
</li>
<li>F.eks. h(K) = K MOD M (restfunksjon)</li>
<li>Mange mulige hashfunksjoner</li>
<li>En god hashfunksjon har god spredning, men er avhengig av hva som skal spres</li>
<li>Hvordan hÃ¥ndtere overflyt
<ul>
<li>Ã…pen adressering: lagre posten i fÃ¸rste ledige etterfÃ¸lgende blokk i fila</li>
<li>Separat overlÃ¸p: lenk sammen overlÃ¸psblokker</li>
<li>Multippel hashing: bruk en ny hashfunksjon nÃ¥r det blir kollisjoner</li>
</ul>
</li>
</ul>
<h2 id="statisk-hashing-(1)" tabindex="-1">Statisk hashing (1)</h2>
<p><img src="assets/Pasted image 20220329173724.png" alt=""></p>
<h2 id="statisk-hashing-(2)" tabindex="-1">Statisk hashing (2)</h2>
<ul>
<li>Partition by key i MySQL</li>
</ul>
<pre><code class="hljs language-sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> tm1 (
s1 <span class="hljs-type">CHAR</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">PRIMARY</span> KEY
)
<span class="hljs-keyword">PARTITION</span> <span class="hljs-keyword">BY</span> KEY(s1)
PARTITIONS <span class="hljs-number">10</span>;
</code></pre>
<ul>
<li>Fast antall blokker/partisjoner i samme fil</li>
<li>MÃ¥ bruke overlÃ¸p for dynamiske datamengder (ukjent antall poster)</li>
<li>Lange overlÃ¸p kan Ã¸delegge ytelsen</li>
</ul>
<h2 id="extendible-hashing" tabindex="-1">Extendible hashing</h2>
<ul>
<li>Problem ved statisk hashing.
<ul>
<li>Utvidelse av filen, dvs. dobling av antall blokker</li>
<li>Les alle blokker og skriv alle blokker pÃ¥ nytt.</li>
</ul>
</li>
<li>Extendible hashing
<ul>
<li>Bruk katalog med pekere til blokker og doble katalogen ved
behov</li>
<li>Splitt (les og skriv) kun den blokken som ble full</li>
<li>Lokal og global dybde</li>
<li>Hvis en blokk er full og lokal dybde == global dybde: Directory doubling</li>
</ul>
</li>
</ul>

      </article>
      </div>
  </body>
</html>
